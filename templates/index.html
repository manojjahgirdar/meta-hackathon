<!DOCTYPE html>
<html>
<head>
    <title>Ask User</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const socket = io();
            socket.on('ask_question', (data) => {
                const questionContainer = document.getElementById('questionContainer');
                questionContainer.innerHTML = `
                    <p>(Difficulty: ${data.difficulty}, Taxonomy: ${data.taxonomy}) Question: ${data.question}</p>
                    <ul>
                        ${Object.entries(data.options).map(([key, value]) => `
                            <li>
                                <input type="radio" name="userResponse" value="${key}" id="option_${key}">
                                <label for="option_${key}">${key}: ${value}</label>
                            </li>
                        `).join('')}
                    </ul>
                `;
                document.querySelectorAll('input[name="userResponse"]').forEach((radio) => {
                    radio.addEventListener('change', (event) => {
                        const userResponse = event.target.value;
                        console.log("Sending response: ", userResponse);
                        socket.emit('question_response', userResponse);
                        questionContainer.innerHTML = '';
                    });
                });

                document.body.appendChild(questionContainer);

                document.getElementById('submitResponse').addEventListener('click', () => {
                    const userResponse = document.getElementById('userResponse').value;
                    console.log("Sending response: ", userResponse);
                    socket.emit('question_response', userResponse);
                    document.getElementById('userResponse').value = '';
                    document.getElementById('questionContainer').innerHTML = '';
                });
            });

            // Handle the final_summary event
            socket.on('final_summary', (data) => {
                const summaryContainer = document.getElementById('summaryContainer');
                summaryContainer.innerHTML = `
                    <p>Final Summary:</p>
                    <p>Score: ${data.score} out of 5</p>
                    <p>Rank: ${data.rank}</p>
                    <p>Strengths:</p>
                    <ul>
                        ${data.strengths.map(strength => `<li>${strength}</li>`).join('')}
                    </ul>
                    <p>Weaknesses:</p>
                    <ul>
                        ${data.weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                    </ul>
                `;
            });
        });
    </script>
</head>
<body>
    <h1>Student Portal</h1>
    <p>Waiting for questions...</p>
    <div id="questionContainer"></div>
    <div id="summaryContainer"></div>
</body>
</html>
